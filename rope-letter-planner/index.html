<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rope Letter Planner</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Rope Letter Planner</h1>
    <p>Layout DIN 1451 letter outlines on an 8' × 10' grid and estimate rope routing.</p>
  </header>
  <main>
    <section class="controls">
      <form id="controlsForm">
        <fieldset class="utility-controls">
          <div class="zoom-controls" role="group" aria-label="Zoom controls">
            <button type="button" id="zoomOut" class="ghost-button" aria-label="Zoom out">−</button>
            <span id="zoomReadout" class="zoom-readout" aria-live="polite">100%</span>
            <button type="button" id="zoomIn" class="ghost-button" aria-label="Zoom in">+</button>
          </div>
          <button type="button" id="themeToggle" class="ghost-button" aria-label="Toggle light or dark mode" aria-pressed="false">Dark mode</button>
          <div class="nudge-controls" role="group" aria-label="Letter position nudges">
            <span>Nudge</span>
            <div class="nudge-buttons">
              <button type="button" id="nudgeUp" class="nudge-button" aria-label="Nudge up">↑</button>
              <div>
                <button type="button" id="nudgeLeft" class="nudge-button" aria-label="Nudge left">←</button>
                <button type="button" id="nudgeRight" class="nudge-button" aria-label="Nudge right">→</button>
              </div>
              <button type="button" id="nudgeDown" class="nudge-button" aria-label="Nudge down">↓</button>
            </div>
            <div class="nudge-readout" id="nudgeReadout" aria-live="polite">Offset X: 0.00 in, Y: 0.00 in</div>
            <button type="button" id="resetLetterButton" class="ghost-button ghost-button--small" aria-label="Reset letter offset">Reset</button>
            <label class="toggle" for="strictManualToggle">
              <input type="checkbox" id="strictManualToggle">
              <span>Strict manual nudges</span>
            </label>
            <button type="button" id="applySnapButton" class="ghost-button ghost-button--small" aria-label="Reapply grid snap">Snap to grid</button>
          </div>
        </fieldset>
        <fieldset>
          <legend>Message</legend>
          <label>
            Letter
            <input type="text" id="textInput" maxlength="1" placeholder="A" value="A" autocomplete="off">
          </label>
          <label>
            Letter spacing (em)
            <input type="number" id="letterSpacingInput" min="-0.5" max="2" step="0.05" value="0">
          </label>
          <label>
            Scale (% of available height)
            <input type="range" id="scaleSlider" min="40" max="100" step="1" value="80">
            <span id="scaleValue">80%</span>
          </label>
        </fieldset>

        <fieldset>
          <legend>Grid &amp; Rope</legend>
          <div class="grid-spacing">
            <label>
              Horizontal spacing (in)
              <input type="number" id="gridSpacingXInput" min="0.5" max="12" step="0.5" value="2">
            </label>
            <label>
              Vertical spacing (in)
            <input type="number" id="gridSpacingYInput" min="0.5" max="12" step="0.5" value="4">
            </label>
          </div>
          <label>
            Snap tolerance (in)
            <input type="number" id="snapToleranceInput" min="0" max="2" step="0.05" value="0.75">
          </label>
          <label>
            Rope thickness (in)
            <input type="number" id="ropeThicknessInput" min="0.1" max="2" step="0.05" value="0.5">
          </label>
          <label class="checkbox">
            <input type="checkbox" id="showGridToggle" checked>
            Show grid lines
          </label>
          <label class="checkbox">
            <input type="checkbox" id="keepInBoundsToggle" checked>
            Keep letter within panel
          </label>
        </fieldset>

        <fieldset>
          <legend>Grid Points</legend>
          <div class="point-tools">
            <div id="cursorReadout" class="cursor-readout">Cursor: —</div>
            <div class="point-buttons">
              <button type="button" id="clearPointsButton" class="ghost-button ghost-button--small">Clear points</button>
            </div>
            <ol id="pointsList" class="points-list" aria-live="polite"></ol>
          </div>
        </fieldset>

        <fieldset>
          <legend>Font</legend>
          <p class="hint">Load a DIN 1451 compatible <code>.ttf</code> file to start planning.</p>
          <label class="file-label">
            <span>Upload font</span>
            <input type="file" id="fontInput" accept=".ttf,.otf">
          </label>
          <div id="fontDropZone" class="drop-zone" tabindex="0" role="button" aria-label="Drop DIN font file">
            <span>…or drag &amp; drop a DIN 1451 font here</span>
          </div>
          <p id="fontStatus" class="status status-warn">No font loaded.</p>
        </fieldset>
      </form>
    </section>

    <section class="visualizer">
      <div class="canvas-wrapper">
        <div class="canvas-viewport" id="canvasViewport">
          <canvas id="plannerCanvas" width="768" height="960"></canvas>
        </div>
        <div class="canvas-overlay" id="canvasMessage">Load a DIN 1451 font to begin.</div>
      </div>
      <aside class="legend">
        <h2>Legend</h2>
        <ul>
          <li><span class="swatch swatch-lit"></span>Lit rope path</li>
          <li><span class="swatch swatch-blackout"></span>Blackout crossover</li>
          <li><span class="swatch swatch-entry"></span>Power entry</li>
          <li><span class="swatch swatch-tie"></span>Zip tie points</li>
          <li><span class="swatch swatch-point"></span>Captured points</li>
        </ul>
      </aside>
    </section>

    <section class="report">
      <h2>Rope Summary</h2>
      <div class="split">
        <dl class="totals">
          <div>
            <dt>Total lit rope</dt>
            <dd id="totalLit">0 in</dd>
          </div>
          <div>
            <dt>Total blackout</dt>
            <dd id="totalBlackout">0 in</dd>
          </div>
          <div>
            <dt>Overall rope</dt>
            <dd id="totalOverall">0 in</dd>
          </div>
        </dl>
        <div class="actions">
          <button type="button" id="exportButton">Export JSON</button>
        </div>
      </div>
      <table id="letterTable">
        <thead>
          <tr>
            <th>Letter</th>
            <th>Outline length (in)</th>
            <th>Blackout length (in)</th>
            <th>Segments</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="4" class="empty">Load a font and enter text to see rope estimates.</td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <footer>
    <p>Powered by opentype.js. Bring your own DIN 1451 font file.</p>
  </footer>

  <script src="vendor/opentype.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
